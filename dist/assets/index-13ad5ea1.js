var F=Object.defineProperty;var N=(h,r,f)=>r in h?F(h,r,{enumerable:!0,configurable:!0,writable:!0,value:f}):h[r]=f;var k=(h,r,f)=>(N(h,typeof r!="symbol"?r+"":r,f),f);(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))d(t);new MutationObserver(t=>{for(const e of t)if(e.type==="childList")for(const s of e.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&d(s)}).observe(document,{childList:!0,subtree:!0});function f(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?e.credentials="include":t.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function d(t){if(t.ep)return;t.ep=!0;const e=f(t);fetch(t.href,e)}})();const V=0,z=1,_=8,M=28;class U{static read_bytes(r,f){let d=new U;return d.buf=r.getUint32(f,!0),d.buf_len=r.getUint32(f+4,!0),d}static read_bytes_array(r,f,d){let t=[];for(let e=0;e<d;e++)t.push(U.read_bytes(r,f+8*e));return t}}class T{static read_bytes(r,f){let d=new T;return d.buf=r.getUint32(f,!0),d.buf_len=r.getUint32(f+4,!0),d}static read_bytes_array(r,f,d){let t=[];for(let e=0;e<d;e++)t.push(T.read_bytes(r,f+8*e));return t}}const O=0,S=1,R=2,v=4;class j{write_bytes(r,f){r.setUint8(f,this.fs_filetype),r.setUint16(f+2,this.fs_flags,!0),r.setBigUint64(f+8,this.fs_rights_base,!0),r.setBigUint64(f+16,this.fs_rights_inherited,!0)}constructor(r,f){this.fs_rights_base=0n,this.fs_rights_inherited=0n,this.fs_filetype=r,this.fs_flags=f}}class W{write_bytes(r,f){r.setBigUint64(f,this.dev,!0),r.setBigUint64(f+8,this.ino,!0),r.setUint8(f+16,this.filetype),r.setBigUint64(f+24,this.nlink,!0),r.setBigUint64(f+32,this.size,!0),r.setBigUint64(f+38,this.atim,!0),r.setBigUint64(f+46,this.mtim,!0),r.setBigUint64(f+52,this.ctim,!0)}constructor(r,f){this.dev=0n,this.ino=0n,this.nlink=0n,this.atim=0n,this.mtim=0n,this.ctim=0n,this.filetype=r,this.size=f}}let H=class{start(r){this.inst=r,r.exports._start()}initialize(r){this.inst=r,r.exports._initialize()}constructor(r,f,d){this.args=[],this.env=[],this.fds=[],this.args=r,this.env=f,this.fds=d;let t=this;this.wasiImport={args_sizes_get(e,s){let n=new DataView(t.inst.exports.memory.buffer);n.setUint32(e,t.args.length,!0);let i=0;for(let a of t.args)i+=a.length+1;return n.setUint32(s,i,!0),0},args_get(e,s){let n=new DataView(t.inst.exports.memory.buffer),i=new Uint8Array(t.inst.exports.memory.buffer);for(let a=0;a<t.args.length;a++){n.setUint32(e,s,!0),e+=4;let o=new TextEncoder("utf-8").encode(t.args[a]);i.set(o,s),n.setUint8(s+o.length,0),s+=o.length+1}return 0},environ_sizes_get(e,s){let n=new DataView(t.inst.exports.memory.buffer);n.setUint32(e,t.env.length,!0);let i=0;for(let a of t.env)i+=a.length+1;return n.setUint32(s,i,!0),0},environ_get(e,s){let n=new DataView(t.inst.exports.memory.buffer),i=new Uint8Array(t.inst.exports.memory.buffer);for(let a=0;a<f.length;a++){n.setUint32(e,s,!0),e+=4;let o=new TextEncoder("utf-8").encode(f[a]);i.set(o,s),n.setUint8(s+o.length,0),s+=o.length+1}return 0},clock_res_get(e,s){throw"unimplemented"},clock_time_get(e,s,n){let i=new DataView(t.inst.exports.memory.buffer);if(e===V)i.setBigUint64(n,BigInt(new Date().getTime())*1000000n,!0);else if(e==z){let a;try{a=BigInt(Math.round(performance.now()*1e6))}catch{a=0n}i.setBigUint64(n,a,!0)}else i.setBigUint64(n,0n,!0);return 0},fd_advise(e,s,n,i){return t.fds[e]!=null?t.fds[e].fd_advise(s,n,i):_},fd_allocate(e,s,n){return t.fds[e]!=null?t.fds[e].fd_allocate(s,n):_},fd_close(e){if(t.fds[e]!=null){let s=t.fds[e].fd_close();return t.fds[e]=void 0,s}else return _},fd_datasync(e){return t.fds[e]!=null?t.fds[e].fd_datasync():_},fd_fdstat_get(e,s){if(t.fds[e]!=null){let{ret:n,fdstat:i}=t.fds[e].fd_fdstat_get();return i!=null&&i.write_bytes(new DataView(t.inst.exports.memory.buffer),s),n}else return _},fd_fdstat_set_flags(e,s){return t.fds[e]!=null?t.fds[e].fd_fdstat_set_flags(s):_},fd_fdstat_set_rights(e,s,n){return t.fds[e]!=null?t.fds[e].fd_fdstat_set_rights(s,n):_},fd_filestat_get(e,s){if(t.fds[e]!=null){let{ret:n,filestat:i}=t.fds[e].fd_filestat_get();return i!=null&&i.write_bytes(new DataView(t.inst.exports.memory.buffer),s),n}else return _},fd_filestat_set_size(e,s){return t.fds[e]!=null?t.fds[e].fd_filestat_set_size(s):_},fd_filestat_set_times(e,s,n,i){return t.fds[e]!=null?t.fds[e].fd_filestat_set_times(s,n,i):_},fd_pread(e,s,n,i,a){let o=new DataView(t.inst.exports.memory.buffer),u=new Uint8Array(t.inst.exports.memory.buffer);if(t.fds[e]!=null){let l=U.read_bytes_array(o,s,n),{ret:m,nread:c}=t.fds[e].fd_pread(u,l,i);return o.setUint32(a,c,!0),m}else return _},fd_prestat_get(e,s){let n=new DataView(t.inst.exports.memory.buffer);if(t.fds[e]!=null){let{ret:i,prestat:a}=t.fds[e].fd_prestat_get();return a!=null&&a.write_bytes(n,s),i}else return _},fd_prestat_dir_name(e,s,n){if(t.fds[e]!=null){let{ret:i,prestat_dir_name:a}=t.fds[e].fd_prestat_dir_name();return a!=null&&new Uint8Array(t.inst.exports.memory.buffer).set(a,s),i}else return _},fd_pwrite(e,s,n,i,a){let o=new DataView(t.inst.exports.memory.buffer),u=new Uint8Array(t.inst.exports.memory.buffer);if(t.fds[e]!=null){let l=T.read_bytes_array(o,s,n),{ret:m,nwritten:c}=t.fds[e].fd_pwrite(u,l,i);return o.setUint32(a,c,!0),m}else return _},fd_read(e,s,n,i){let a=new DataView(t.inst.exports.memory.buffer),o=new Uint8Array(t.inst.exports.memory.buffer);if(t.fds[e]!=null){let u=U.read_bytes_array(a,s,n),{ret:l,nread:m}=t.fds[e].fd_read(o,u);return a.setUint32(i,m,!0),l}else return _},fd_readdir(e,s,n,i,a){let o=new DataView(t.inst.exports.memory.buffer),u=new Uint8Array(t.inst.exports.memory.buffer);if(t.fds[e]!=null){let l=0;for(;;){let{ret:m,dirent:c}=t.fds[e].fd_readdir_single(i);if(m!=0)return o.setUint32(a,l,!0),m;if(c==null)break;if(n-l<c.head_length()){l=n;break}let p=new ArrayBuffer(c.head_length());if(c.write_head_bytes(new DataView(p),0),u.set(new Uint8Array(p).slice(0,Math.min(p.byteLength,n-l)),s),s+=c.head_length(),l+=c.head_length(),n-l<c.name_length()){l=n;break}c.write_name_bytes(u,s,n-l),s+=c.name_length(),l+=c.name_length(),i=c.d_next}return o.setUint32(a,l,!0),0}else return _},fd_renumber(e,s){if(t.fds[e]!=null&&t.fds[s]!=null){let n=t.fds[s].fd_close();return n!=0?n:(t.fds[s]=t.fds[e],t.fds[e]=void 0,0)}else return _},fd_seek(e,s,n,i){let a=new DataView(t.inst.exports.memory.buffer);if(t.fds[e]!=null){let{ret:o,offset:u}=t.fds[e].fd_seek(s,n);return a.setBigInt64(i,u,!0),o}else return _},fd_sync(e){return t.fds[e]!=null?t.fds[e].fd_sync():_},fd_tell(e,s){let n=new DataView(t.inst.exports.memory.buffer);if(t.fds[e]!=null){let{ret:i,offset:a}=t.fds[e].fd_tell();return n.setBigUint64(s,a,!0),i}else return _},fd_write(e,s,n,i){let a=new DataView(t.inst.exports.memory.buffer),o=new Uint8Array(t.inst.exports.memory.buffer);if(t.fds[e]!=null){let u=T.read_bytes_array(a,s,n),{ret:l,nwritten:m}=t.fds[e].fd_write(o,u);return a.setUint32(i,m,!0),l}else return _},path_create_directory(e,s,n){let i=new Uint8Array(t.inst.exports.memory.buffer);if(t.fds[e]!=null){let a=new TextDecoder("utf-8").decode(i.slice(s,s+n));return t.fds[e].path_create_directory(a)}},path_filestat_get(e,s,n,i,a){let o=new DataView(t.inst.exports.memory.buffer),u=new Uint8Array(t.inst.exports.memory.buffer);if(t.fds[e]!=null){let l=new TextDecoder("utf-8").decode(u.slice(n,n+i)),{ret:m,filestat:c}=t.fds[e].path_filestat_get(s,l);return c!=null&&c.write_bytes(o,a),m}else return _},path_filestat_set_times(e,s,n,i,a,o,u){let l=new Uint8Array(t.inst.exports.memory.buffer);if(t.fds[e]!=null){let m=new TextDecoder("utf-8").decode(l.slice(n,n+i));return t.fds[e].path_filestat_set_times(s,m,a,o,u)}else return _},path_link(e,s,n,i,a,o,u){let l=new Uint8Array(t.inst.exports.memory.buffer);if(t.fds[e]!=null&&t.fds[a]!=null){let m=new TextDecoder("utf-8").decode(l.slice(n,n+i)),c=new TextDecoder("utf-8").decode(l.slice(o,o+u));return t.fds[a].path_link(e,s,m,c)}else return _},path_open(e,s,n,i,a,o,u,l,m){let c=new DataView(t.inst.exports.memory.buffer),p=new Uint8Array(t.inst.exports.memory.buffer);if(t.fds[e]!=null){let y=new TextDecoder("utf-8").decode(p.slice(n,n+i)),{ret:g,fd_obj:w}=t.fds[e].path_open(s,y,a,o,u,l);if(g!=0)return g;t.fds.push(w);let A=t.fds.length-1;return c.setUint32(m,A,!0),0}else return _},path_readlink(e,s,n,i,a,o){let u=new DataView(t.inst.exports.memory.buffer),l=new Uint8Array(t.inst.exports.memory.buffer);if(t.fds[e]!=null){let m=new TextDecoder("utf-8").decode(l.slice(s,s+n)),{ret:c,data:p}=t.fds[e].path_readlink(m);if(p!=null){if(p.length>a)return u.setUint32(o,0,!0),_;l.set(p,i),u.setUint32(o,p.length,!0)}return c}else return _},path_remove_directory(e,s,n){let i=new Uint8Array(t.inst.exports.memory.buffer);if(t.fds[e]!=null){let a=new TextDecoder("utf-8").decode(i.slice(s,s+n));return t.fds[e].path_remove_directory(a)}else return _},path_rename(e,s,n,i,a,o){throw"FIXME what is the best abstraction for this?"},path_symlink(e,s,n,i,a){let o=new Uint8Array(t.inst.exports.memory.buffer);if(t.fds[n]!=null){let u=new TextDecoder("utf-8").decode(o.slice(e,e+s)),l=new TextDecoder("utf-8").decode(o.slice(i,i+a));return t.fds[n].path_symlink(u,l)}else return _},path_unlink_file(e,s,n){let i=new Uint8Array(t.inst.exports.memory.buffer);if(t.fds[e]!=null){let a=new TextDecoder("utf-8").decode(i.slice(s,s+n));return t.fds[e].path_unlink_file(a)}else return _},poll_oneoff(e,s,n){throw"async io not supported"},proc_exit(e){throw"exit with exit code "+e},proc_raise(e){throw"raised signal "+e},sched_yield(){},random_get(e,s){let n=new Uint8Array(t.inst.exports.memory.buffer);for(let i=0;i<s;i++)n[e+i]=Math.random()*256|0},sock_recv(e,s,n){throw"sockets not supported"},sock_send(e,s,n){throw"sockets not supported"},sock_shutdown(e,s){throw"sockets not supported"}}}};class G{fd_advise(r,f,d){return-1}fd_allocate(r,f){return-1}fd_close(){return 0}fd_datasync(){return-1}fd_fdstat_get(){return{ret:-1,fdstat:null}}fd_fdstat_set_flags(r){return-1}fd_fdstat_set_rights(r,f){return-1}fd_filestat_get(){return{ret:-1,filestat:null}}fd_filestat_set_size(r){return-1}fd_filestat_set_times(r,f,d){return-1}fd_pread(r,f,d){return{ret:-1,nread:0}}fd_prestat_get(){return{ret:-1,prestat:null}}fd_prestat_dir_name(r,f){return{ret:-1,prestat_dir_name:null}}fd_pwrite(r,f,d){return{ret:-1,nwritten:0}}fd_read(r,f){return{ret:-1,nread:0}}fd_readdir_single(r){return{ret:-1,dirent:null}}fd_seek(r,f){return{ret:-1,offset:0n}}fd_sync(){return 0}fd_tell(){return{ret:-1,offset:0n}}fd_write(r,f){return{ret:-1,nwritten:0}}path_create_directory(r){return-1}path_filestat_get(r,f){return{ret:-1,filestat:null}}path_filestat_set_times(r,f,d,t,e){return-1}path_link(r,f,d,t){return-1}path_open(r,f,d,t,e,s){return{ret:-1,fd_obj:null}}path_readlink(r){return{ret:-1,data:null}}path_remove_directory(r){return-1}path_rename(r,f,d){return-1}path_symlink(r,f){return-1}path_unlink_file(r){return-1}}class C{get size(){return BigInt(this.data.byteLength)}stat(){return new W(v,this.size)}truncate(){this.data=new Uint8Array([])}constructor(r){this.data=new Uint8Array(r)}}class I extends G{fd_fdstat_get(){return{ret:0,fdstat:new j(v,0)}}fd_read(r,f){let d=0;for(let t of f)if(this.file_pos<this.file.data.byteLength){let e=this.file.data.slice(Number(this.file_pos),Number(this.file_pos+BigInt(t.buf_len)));r.set(e,t.buf),this.file_pos+=BigInt(e.length),d+=e.length}else break;return{ret:0,nread:d}}fd_seek(r,f){let d;switch(f){case O:d=r;break;case S:d=this.file_pos+r;break;case R:d=BigInt(this.file.data.byteLength)+r;break;default:return{ret:M,offset:0n}}return d<0?{ret:M,offset:0n}:(this.file_pos=d,{ret:0,offset:this.file_pos})}fd_write(r,f){let d=0;for(let t of f){let e=r.slice(t.buf,t.buf+t.buf_len);if(this.file_pos+BigInt(e.byteLength)>this.file.size){let s=this.file.data;this.file.data=new Uint8Array(Number(this.file_pos+BigInt(e.byteLength))),this.file.data.set(s)}this.file.data.set(e.slice(0,Number(this.file.size-this.file_pos)),Number(this.file_pos)),this.file_pos+=BigInt(e.byteLength),d+=t.buf_len}return{ret:0,nwritten:d}}fd_filestat_get(){return{ret:0,filestat:this.file.stat()}}constructor(r){super(),this.file_pos=0n,this.file=r}}const P=["♈︎","♉︎","♊︎","♋︎","♌︎","♍︎","♎︎","♏︎","♐︎","♑︎","♒︎","♓︎"];var L=(h=>(h[h.Placidus="P".charCodeAt(0)]="Placidus",h[h.Regiomontanus="R".charCodeAt(0)]="Regiomontanus",h))(L||{});const K=[0,1,2,3,4,5,6],Y={0:"☉",1:"☽",2:"☿",3:"♀",4:"♂",5:"♃",6:"♄"};class q{constructor(r){this.astro=r}jd(r){const f=r.getUTCFullYear(),d=r.getUTCMonth()+1,t=r.getUTCDate(),e=r.getUTCHours(),s=r.getUTCMinutes(),n=r.getUTCSeconds()+r.getUTCMilliseconds()/1e3,i=1,a=0,o=2*8;if(this.astro.swe_utc_to_jd(f,d,t,e,s,n,i,a,o)<0){const m=new Uint8Array(this.astro.memory.buffer,o,256);return{jd:0,err:new TextDecoder().decode(m)}}return{jd:new Float64Array(this.astro.memory.buffer,a,2)[1]}}planetPos(r,f){if(this.astro.swe_calc_ut(r,f,0,0,48)<0){const a=new Uint8Array(this.astro.memory.buffer,48,256);return{lon:0,err:new TextDecoder().decode(a)}}return{lon:new Float64Array(this.astro.memory.buffer,0,6)[0]}}houses(r,f,d,t){this.astro.swe_houses(r,f,d,t,0,104);const n=new Float64Array(this.astro.memory.buffer,0,13);return Array.from(n).slice(1)}}async function X(){const h=[],r=[],f=[new I(new C([])),new I(new C([])),new I(new C([]))],d=new H(h,r,f),t=await WebAssembly.compileStreaming(fetch("astro.wasm")),e=await WebAssembly.instantiate(t,{wasi_snapshot_preview1:d.wasiImport});return d.start(e),new q(e.exports)}class J{constructor(r,f,d,t,e){k(this,"date",new Date);k(this,"geolat",-19-55/60);k(this,"geolon",-43-56/60);this.ctx=r,this.sweph=f,this.width=d,this.height=t,this.radius=e}setGeopos(r,f){this.geolat=r,this.geolon=f,this.render(this.date)}render(r){this.ctx.clearRect(0,0,this.width,this.height),this.date=r;const{jd:f,err:d}=this.sweph.jd(r);if(d)throw d;this.ctx.strokeStyle="#FFFFFF",this.ctx.beginPath(),this.ctx.arc(this.width/2,this.height/2,this.radius,0,2*Math.PI),this.ctx.stroke();const t=this.sweph.houses(f,this.geolat,this.geolon,L.Placidus),e=180+t[0];this.ctx.font="20px Arial",this.ctx.fillStyle="#FFFFFF",this.ctx.textAlign="center";for(let i=0;i<t.length;i++){const a=(e-t[i])*Math.PI/180;this.ctx.moveTo(this.width/2,this.height/2);const o=this.width/2+this.radius*Math.cos(a),u=this.height/2+this.radius*Math.sin(a);this.ctx.lineTo(o,u),this.ctx.stroke()}const s=this.radius+20;for(const i of K){const a=Y[i],{lon:o,err:u}=this.sweph.planetPos(f,i);if(u)throw u;const l=(e-o)*Math.PI/180,m=this.width/2+s*Math.cos(l),c=this.height/2+s*Math.sin(l);this.ctx.fillText(a,m,c)}const n=this.radius+35;for(let i=0;i<P.length;i++){const a=(e-i*30-15)*Math.PI/180,o=this.width/2+n*Math.cos(a),u=this.height/2+n*Math.sin(a);this.ctx.fillText(P[i],o,u);const l=(e-i*30)*Math.PI/180,m=this.width/2+this.radius*Math.cos(l),c=this.height/2+this.radius*Math.sin(l),p=this.width/2+(this.radius+30)*Math.cos(l),y=this.height/2+(this.radius+30)*Math.sin(l);this.ctx.moveTo(m,c),this.ctx.lineTo(p,y),this.ctx.stroke()}}}async function Q(){const h=document.getElementById("app");if(!h)throw new Error("No app element");const r=document.createElement("canvas"),{innerWidth:f,innerHeight:d}=window,t=Math.min(f,d),e=t,s=t,n=(t-100)/2;r.width=e,r.height=s;const i=await X(),a=r.getContext("2d");if(!a)throw new Error("No canvas context");const o=new J(a,i,e,s,n);o.render(new Date);const u=document.createElement("p");u.style.fontSize="2rem",u.style.color="#487297",u.innerHTML=o.date.toISOString().slice(0,16).replace("T"," ")+" UTC";const l=document.createElement("div"),m=[{txt:"-1min",dt:-60*1e3},{txt:"+1min",dt:60*1e3},{txt:"-1h",dt:-60*60*1e3},{txt:"+1h",dt:60*60*1e3},{txt:"-1d",dt:-24*60*60*1e3},{txt:"+1d",dt:24*60*60*1e3}],c=[];for(const{txt:x,dt:B}of m){const E=document.createElement("button");c.push(E),E.innerHTML=x,E.style.margin="0 0.5rem",E.onclick=()=>{o.date.setTime(o.date.getTime()+B),o.render(o.date),u.innerHTML=o.date.toISOString().slice(0,16).replace("T"," ")+" UTC"}}const p=document.createElement("div"),y=document.createElement("div"),g=document.createElement("label");g.innerHTML="Latitude",g.style.margin="0 0.5rem",g.style.color="#487297";const w=document.createElement("input");w.type="number",w.value=(-20).toString(),y.append(g,w);const A=document.createElement("div"),D=document.createElement("label");D.innerHTML="Longitude",D.style.margin="0 0.5rem",D.style.color="#487297";const b=document.createElement("input");b.type="number",b.value=(-44).toString(),A.append(D,b),p.append(y,A),p.style.marginBottom="2rem",[w,b].forEach(x=>{x.onchange=()=>{o.setGeopos(Number(w.value),Number(b.value))}}),h.append(u),h.appendChild(p),h.appendChild(r),c.forEach(x=>l.appendChild(x)),h.appendChild(l)}Q().catch(h=>console.error(h));
