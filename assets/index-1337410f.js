var P=Object.defineProperty;var M=(_,r,f)=>r in _?P(_,r,{enumerable:!0,configurable:!0,writable:!0,value:f}):_[r]=f;var U=(_,r,f)=>(M(_,typeof r!="symbol"?r+"":r,f),f);(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const e of t)if(e.type==="childList")for(const s of e.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function f(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?e.credentials="include":t.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function o(t){if(t.ep)return;t.ep=!0;const e=f(t);fetch(t.href,e)}})();const L=0,v=1,m=8,E=28;class b{static read_bytes(r,f){let o=new b;return o.buf=r.getUint32(f,!0),o.buf_len=r.getUint32(f+4,!0),o}static read_bytes_array(r,f,o){let t=[];for(let e=0;e<o;e++)t.push(b.read_bytes(r,f+8*e));return t}}class x{static read_bytes(r,f){let o=new x;return o.buf=r.getUint32(f,!0),o.buf_len=r.getUint32(f+4,!0),o}static read_bytes_array(r,f,o){let t=[];for(let e=0;e<o;e++)t.push(x.read_bytes(r,f+8*e));return t}}const B=0,F=1,N=2,I=4;class V{write_bytes(r,f){r.setUint8(f,this.fs_filetype),r.setUint16(f+2,this.fs_flags,!0),r.setBigUint64(f+8,this.fs_rights_base,!0),r.setBigUint64(f+16,this.fs_rights_inherited,!0)}constructor(r,f){this.fs_rights_base=0n,this.fs_rights_inherited=0n,this.fs_filetype=r,this.fs_flags=f}}class z{write_bytes(r,f){r.setBigUint64(f,this.dev,!0),r.setBigUint64(f+8,this.ino,!0),r.setUint8(f+16,this.filetype),r.setBigUint64(f+24,this.nlink,!0),r.setBigUint64(f+32,this.size,!0),r.setBigUint64(f+38,this.atim,!0),r.setBigUint64(f+46,this.mtim,!0),r.setBigUint64(f+52,this.ctim,!0)}constructor(r,f){this.dev=0n,this.ino=0n,this.nlink=0n,this.atim=0n,this.mtim=0n,this.ctim=0n,this.filetype=r,this.size=f}}let O=class{start(r){this.inst=r,r.exports._start()}initialize(r){this.inst=r,r.exports._initialize()}constructor(r,f,o){this.args=[],this.env=[],this.fds=[],this.args=r,this.env=f,this.fds=o;let t=this;this.wasiImport={args_sizes_get(e,s){let n=new DataView(t.inst.exports.memory.buffer);n.setUint32(e,t.args.length,!0);let i=0;for(let a of t.args)i+=a.length+1;return n.setUint32(s,i,!0),0},args_get(e,s){let n=new DataView(t.inst.exports.memory.buffer),i=new Uint8Array(t.inst.exports.memory.buffer);for(let a=0;a<t.args.length;a++){n.setUint32(e,s,!0),e+=4;let l=new TextEncoder("utf-8").encode(t.args[a]);i.set(l,s),n.setUint8(s+l.length,0),s+=l.length+1}return 0},environ_sizes_get(e,s){let n=new DataView(t.inst.exports.memory.buffer);n.setUint32(e,t.env.length,!0);let i=0;for(let a of t.env)i+=a.length+1;return n.setUint32(s,i,!0),0},environ_get(e,s){let n=new DataView(t.inst.exports.memory.buffer),i=new Uint8Array(t.inst.exports.memory.buffer);for(let a=0;a<f.length;a++){n.setUint32(e,s,!0),e+=4;let l=new TextEncoder("utf-8").encode(f[a]);i.set(l,s),n.setUint8(s+l.length,0),s+=l.length+1}return 0},clock_res_get(e,s){throw"unimplemented"},clock_time_get(e,s,n){let i=new DataView(t.inst.exports.memory.buffer);if(e===L)i.setBigUint64(n,BigInt(new Date().getTime())*1000000n,!0);else if(e==v){let a;try{a=BigInt(Math.round(performance.now()*1e6))}catch{a=0n}i.setBigUint64(n,a,!0)}else i.setBigUint64(n,0n,!0);return 0},fd_advise(e,s,n,i){return t.fds[e]!=null?t.fds[e].fd_advise(s,n,i):m},fd_allocate(e,s,n){return t.fds[e]!=null?t.fds[e].fd_allocate(s,n):m},fd_close(e){if(t.fds[e]!=null){let s=t.fds[e].fd_close();return t.fds[e]=void 0,s}else return m},fd_datasync(e){return t.fds[e]!=null?t.fds[e].fd_datasync():m},fd_fdstat_get(e,s){if(t.fds[e]!=null){let{ret:n,fdstat:i}=t.fds[e].fd_fdstat_get();return i!=null&&i.write_bytes(new DataView(t.inst.exports.memory.buffer),s),n}else return m},fd_fdstat_set_flags(e,s){return t.fds[e]!=null?t.fds[e].fd_fdstat_set_flags(s):m},fd_fdstat_set_rights(e,s,n){return t.fds[e]!=null?t.fds[e].fd_fdstat_set_rights(s,n):m},fd_filestat_get(e,s){if(t.fds[e]!=null){let{ret:n,filestat:i}=t.fds[e].fd_filestat_get();return i!=null&&i.write_bytes(new DataView(t.inst.exports.memory.buffer),s),n}else return m},fd_filestat_set_size(e,s){return t.fds[e]!=null?t.fds[e].fd_filestat_set_size(s):m},fd_filestat_set_times(e,s,n,i){return t.fds[e]!=null?t.fds[e].fd_filestat_set_times(s,n,i):m},fd_pread(e,s,n,i,a){let l=new DataView(t.inst.exports.memory.buffer),u=new Uint8Array(t.inst.exports.memory.buffer);if(t.fds[e]!=null){let d=b.read_bytes_array(l,s,n),{ret:h,nread:c}=t.fds[e].fd_pread(u,d,i);return l.setUint32(a,c,!0),h}else return m},fd_prestat_get(e,s){let n=new DataView(t.inst.exports.memory.buffer);if(t.fds[e]!=null){let{ret:i,prestat:a}=t.fds[e].fd_prestat_get();return a!=null&&a.write_bytes(n,s),i}else return m},fd_prestat_dir_name(e,s,n){if(t.fds[e]!=null){let{ret:i,prestat_dir_name:a}=t.fds[e].fd_prestat_dir_name();return a!=null&&new Uint8Array(t.inst.exports.memory.buffer).set(a,s),i}else return m},fd_pwrite(e,s,n,i,a){let l=new DataView(t.inst.exports.memory.buffer),u=new Uint8Array(t.inst.exports.memory.buffer);if(t.fds[e]!=null){let d=x.read_bytes_array(l,s,n),{ret:h,nwritten:c}=t.fds[e].fd_pwrite(u,d,i);return l.setUint32(a,c,!0),h}else return m},fd_read(e,s,n,i){let a=new DataView(t.inst.exports.memory.buffer),l=new Uint8Array(t.inst.exports.memory.buffer);if(t.fds[e]!=null){let u=b.read_bytes_array(a,s,n),{ret:d,nread:h}=t.fds[e].fd_read(l,u);return a.setUint32(i,h,!0),d}else return m},fd_readdir(e,s,n,i,a){let l=new DataView(t.inst.exports.memory.buffer),u=new Uint8Array(t.inst.exports.memory.buffer);if(t.fds[e]!=null){let d=0;for(;;){let{ret:h,dirent:c}=t.fds[e].fd_readdir_single(i);if(h!=0)return l.setUint32(a,d,!0),h;if(c==null)break;if(n-d<c.head_length()){d=n;break}let p=new ArrayBuffer(c.head_length());if(c.write_head_bytes(new DataView(p),0),u.set(new Uint8Array(p).slice(0,Math.min(p.byteLength,n-d)),s),s+=c.head_length(),d+=c.head_length(),n-d<c.name_length()){d=n;break}c.write_name_bytes(u,s,n-d),s+=c.name_length(),d+=c.name_length(),i=c.d_next}return l.setUint32(a,d,!0),0}else return m},fd_renumber(e,s){if(t.fds[e]!=null&&t.fds[s]!=null){let n=t.fds[s].fd_close();return n!=0?n:(t.fds[s]=t.fds[e],t.fds[e]=void 0,0)}else return m},fd_seek(e,s,n,i){let a=new DataView(t.inst.exports.memory.buffer);if(t.fds[e]!=null){let{ret:l,offset:u}=t.fds[e].fd_seek(s,n);return a.setBigInt64(i,u,!0),l}else return m},fd_sync(e){return t.fds[e]!=null?t.fds[e].fd_sync():m},fd_tell(e,s){let n=new DataView(t.inst.exports.memory.buffer);if(t.fds[e]!=null){let{ret:i,offset:a}=t.fds[e].fd_tell();return n.setBigUint64(s,a,!0),i}else return m},fd_write(e,s,n,i){let a=new DataView(t.inst.exports.memory.buffer),l=new Uint8Array(t.inst.exports.memory.buffer);if(t.fds[e]!=null){let u=x.read_bytes_array(a,s,n),{ret:d,nwritten:h}=t.fds[e].fd_write(l,u);return a.setUint32(i,h,!0),d}else return m},path_create_directory(e,s,n){let i=new Uint8Array(t.inst.exports.memory.buffer);if(t.fds[e]!=null){let a=new TextDecoder("utf-8").decode(i.slice(s,s+n));return t.fds[e].path_create_directory(a)}},path_filestat_get(e,s,n,i,a){let l=new DataView(t.inst.exports.memory.buffer),u=new Uint8Array(t.inst.exports.memory.buffer);if(t.fds[e]!=null){let d=new TextDecoder("utf-8").decode(u.slice(n,n+i)),{ret:h,filestat:c}=t.fds[e].path_filestat_get(s,d);return c!=null&&c.write_bytes(l,a),h}else return m},path_filestat_set_times(e,s,n,i,a,l,u){let d=new Uint8Array(t.inst.exports.memory.buffer);if(t.fds[e]!=null){let h=new TextDecoder("utf-8").decode(d.slice(n,n+i));return t.fds[e].path_filestat_set_times(s,h,a,l,u)}else return m},path_link(e,s,n,i,a,l,u){let d=new Uint8Array(t.inst.exports.memory.buffer);if(t.fds[e]!=null&&t.fds[a]!=null){let h=new TextDecoder("utf-8").decode(d.slice(n,n+i)),c=new TextDecoder("utf-8").decode(d.slice(l,l+u));return t.fds[a].path_link(e,s,h,c)}else return m},path_open(e,s,n,i,a,l,u,d,h){let c=new DataView(t.inst.exports.memory.buffer),p=new Uint8Array(t.inst.exports.memory.buffer);if(t.fds[e]!=null){let g=new TextDecoder("utf-8").decode(p.slice(n,n+i)),{ret:w,fd_obj:T}=t.fds[e].path_open(s,g,a,l,u,d);if(w!=0)return w;t.fds.push(T);let y=t.fds.length-1;return c.setUint32(h,y,!0),0}else return m},path_readlink(e,s,n,i,a,l){let u=new DataView(t.inst.exports.memory.buffer),d=new Uint8Array(t.inst.exports.memory.buffer);if(t.fds[e]!=null){let h=new TextDecoder("utf-8").decode(d.slice(s,s+n)),{ret:c,data:p}=t.fds[e].path_readlink(h);if(p!=null){if(p.length>a)return u.setUint32(l,0,!0),m;d.set(p,i),u.setUint32(l,p.length,!0)}return c}else return m},path_remove_directory(e,s,n){let i=new Uint8Array(t.inst.exports.memory.buffer);if(t.fds[e]!=null){let a=new TextDecoder("utf-8").decode(i.slice(s,s+n));return t.fds[e].path_remove_directory(a)}else return m},path_rename(e,s,n,i,a,l){throw"FIXME what is the best abstraction for this?"},path_symlink(e,s,n,i,a){let l=new Uint8Array(t.inst.exports.memory.buffer);if(t.fds[n]!=null){let u=new TextDecoder("utf-8").decode(l.slice(e,e+s)),d=new TextDecoder("utf-8").decode(l.slice(i,i+a));return t.fds[n].path_symlink(u,d)}else return m},path_unlink_file(e,s,n){let i=new Uint8Array(t.inst.exports.memory.buffer);if(t.fds[e]!=null){let a=new TextDecoder("utf-8").decode(i.slice(s,s+n));return t.fds[e].path_unlink_file(a)}else return m},poll_oneoff(e,s,n){throw"async io not supported"},proc_exit(e){throw"exit with exit code "+e},proc_raise(e){throw"raised signal "+e},sched_yield(){},random_get(e,s){let n=new Uint8Array(t.inst.exports.memory.buffer);for(let i=0;i<s;i++)n[e+i]=Math.random()*256|0},sock_recv(e,s,n){throw"sockets not supported"},sock_send(e,s,n){throw"sockets not supported"},sock_shutdown(e,s){throw"sockets not supported"}}}};class S{fd_advise(r,f,o){return-1}fd_allocate(r,f){return-1}fd_close(){return 0}fd_datasync(){return-1}fd_fdstat_get(){return{ret:-1,fdstat:null}}fd_fdstat_set_flags(r){return-1}fd_fdstat_set_rights(r,f){return-1}fd_filestat_get(){return{ret:-1,filestat:null}}fd_filestat_set_size(r){return-1}fd_filestat_set_times(r,f,o){return-1}fd_pread(r,f,o){return{ret:-1,nread:0}}fd_prestat_get(){return{ret:-1,prestat:null}}fd_prestat_dir_name(r,f){return{ret:-1,prestat_dir_name:null}}fd_pwrite(r,f,o){return{ret:-1,nwritten:0}}fd_read(r,f){return{ret:-1,nread:0}}fd_readdir_single(r){return{ret:-1,dirent:null}}fd_seek(r,f){return{ret:-1,offset:0n}}fd_sync(){return 0}fd_tell(){return{ret:-1,offset:0n}}fd_write(r,f){return{ret:-1,nwritten:0}}path_create_directory(r){return-1}path_filestat_get(r,f){return{ret:-1,filestat:null}}path_filestat_set_times(r,f,o,t,e){return-1}path_link(r,f,o,t){return-1}path_open(r,f,o,t,e,s){return{ret:-1,fd_obj:null}}path_readlink(r){return{ret:-1,data:null}}path_remove_directory(r){return-1}path_rename(r,f,o){return-1}path_symlink(r,f){return-1}path_unlink_file(r){return-1}}class A{get size(){return BigInt(this.data.byteLength)}stat(){return new z(I,this.size)}truncate(){this.data=new Uint8Array([])}constructor(r){this.data=new Uint8Array(r)}}class D extends S{fd_fdstat_get(){return{ret:0,fdstat:new V(I,0)}}fd_read(r,f){let o=0;for(let t of f)if(this.file_pos<this.file.data.byteLength){let e=this.file.data.slice(Number(this.file_pos),Number(this.file_pos+BigInt(t.buf_len)));r.set(e,t.buf),this.file_pos+=BigInt(e.length),o+=e.length}else break;return{ret:0,nread:o}}fd_seek(r,f){let o;switch(f){case B:o=r;break;case F:o=this.file_pos+r;break;case N:o=BigInt(this.file.data.byteLength)+r;break;default:return{ret:E,offset:0n}}return o<0?{ret:E,offset:0n}:(this.file_pos=o,{ret:0,offset:this.file_pos})}fd_write(r,f){let o=0;for(let t of f){let e=r.slice(t.buf,t.buf+t.buf_len);if(this.file_pos+BigInt(e.byteLength)>this.file.size){let s=this.file.data;this.file.data=new Uint8Array(Number(this.file_pos+BigInt(e.byteLength))),this.file.data.set(s)}this.file.data.set(e.slice(0,Number(this.file.size-this.file_pos)),Number(this.file_pos)),this.file_pos+=BigInt(e.byteLength),o+=t.buf_len}return{ret:0,nwritten:o}}fd_filestat_get(){return{ret:0,filestat:this.file.stat()}}constructor(r){super(),this.file_pos=0n,this.file=r}}const k=["♈︎","♉︎","♊︎","♋︎","♌︎","♍︎","♎︎","♏︎","♐︎","♑︎","♒︎","♓︎"];var C=(_=>(_[_.Placidus="P".charCodeAt(0)]="Placidus",_[_.Regiomontanus="R".charCodeAt(0)]="Regiomontanus",_))(C||{});const R=[0,1,2,3,4,5,6],j={0:"☉",1:"☽",2:"☿",3:"♀",4:"♂",5:"♃",6:"♄"};class W{constructor(r){this.astro=r}jd(r){const f=r.getUTCFullYear(),o=r.getUTCMonth()+1,t=r.getUTCDate(),e=r.getUTCHours(),s=r.getUTCMinutes(),n=r.getUTCSeconds()+r.getUTCMilliseconds()/1e3,i=1,a=0,l=2*8;if(this.astro.swe_utc_to_jd(f,o,t,e,s,n,i,a,l)<0){const h=new Uint8Array(this.astro.memory.buffer,l,256);return{jd:0,err:new TextDecoder().decode(h)}}return{jd:new Float64Array(this.astro.memory.buffer,a,2)[1]}}planetPos(r,f){if(this.astro.swe_calc_ut(r,f,0,0,48)<0){const a=new Uint8Array(this.astro.memory.buffer,48,256);return{lon:0,err:new TextDecoder().decode(a)}}return{lon:new Float64Array(this.astro.memory.buffer,0,6)[0]}}houses(r,f,o,t){this.astro.swe_houses(r,f,o,t,0,104);const n=new Float64Array(this.astro.memory.buffer,0,13);return Array.from(n).slice(1)}}async function H(){const _=[],r=[],f=[new D(new A([])),new D(new A([])),new D(new A([]))],o=new O(_,r,f),t=await WebAssembly.compileStreaming(fetch("astro.wasm")),e=await WebAssembly.instantiate(t,{wasi_snapshot_preview1:o.wasiImport});return o.start(e),new W(e.exports)}class G{constructor(r,f,o,t,e){U(this,"date",new Date);U(this,"geolat",-19-55/60);U(this,"geolon",-43-56/60);this.ctx=r,this.sweph=f,this.width=o,this.height=t,this.radius=e}setGeopos(r,f){this.geolat=r,this.geolon=f,this.render(this.date)}render(r){this.ctx.clearRect(0,0,this.width,this.height),this.date=r;const{jd:f,err:o}=this.sweph.jd(r);if(o)throw o;this.ctx.strokeStyle="#FFFFFF",this.ctx.beginPath(),this.ctx.arc(this.width/2,this.height/2,this.radius,0,2*Math.PI),this.ctx.stroke();const t=this.sweph.houses(f,this.geolat,this.geolon,C.Placidus),e=180+t[0];this.ctx.font="20px Arial",this.ctx.fillStyle="#FFFFFF",this.ctx.textAlign="center";for(let i=0;i<t.length;i++){const a=(e-t[i])*Math.PI/180;this.ctx.moveTo(this.width/2,this.height/2);const l=this.width/2+this.radius*Math.cos(a),u=this.height/2+this.radius*Math.sin(a);this.ctx.lineTo(l,u),this.ctx.stroke()}const s=this.radius+20;for(const i of R){const a=j[i],{lon:l,err:u}=this.sweph.planetPos(f,i);if(u)throw u;const d=(e-l)*Math.PI/180,h=this.width/2+s*Math.cos(d),c=this.height/2+s*Math.sin(d);this.ctx.fillText(a,h,c)}const n=this.radius+35;for(let i=0;i<k.length;i++){const a=(e-i*30-15)*Math.PI/180,l=this.width/2+n*Math.cos(a),u=this.height/2+n*Math.sin(a);this.ctx.fillText(k[i],l,u);const d=(e-i*30)*Math.PI/180,h=this.width/2+this.radius*Math.cos(d),c=this.height/2+this.radius*Math.sin(d),p=this.width/2+(this.radius+30)*Math.cos(d),g=this.height/2+(this.radius+30)*Math.sin(d);this.ctx.moveTo(h,c),this.ctx.lineTo(p,g),this.ctx.stroke()}}}async function K(){const _=document.getElementById("app");if(!_)throw new Error("No app element");const r=document.createElement("canvas"),f=600,o=600,t=250;r.width=f,r.height=o;const e=await H(),s=r.getContext("2d");if(!s)throw new Error("No canvas context");const n=new G(s,e,f,o,t);n.render(new Date);const i=document.createElement("p");i.style.fontSize="2rem",i.style.color="#487297",i.innerHTML=n.date.toISOString().slice(0,16).replace("T"," ")+" UTC";const a=document.createElement("div"),l=[{txt:"-1min",dt:-60*1e3},{txt:"+1min",dt:60*1e3},{txt:"-1h",dt:-60*60*1e3},{txt:"+1h",dt:60*60*1e3},{txt:"-1d",dt:-24*60*60*1e3},{txt:"+1d",dt:24*60*60*1e3}],u=[];for(const{txt:w,dt:T}of l){const y=document.createElement("button");u.push(y),y.innerHTML=w,y.style.margin="0 0.5rem",y.onclick=()=>{n.date.setTime(n.date.getTime()+T),n.render(n.date),i.innerHTML=n.date.toISOString().slice(0,16).replace("T"," ")+" UTC"}}const d=document.createElement("div"),h=document.createElement("label");h.innerHTML="Latitude",h.style.margin="0 0.5rem",h.style.color="#487297";const c=document.createElement("input");c.type="number",c.value=(-20).toString();const p=document.createElement("label");p.innerHTML="Longitude",p.style.margin="0 0.5rem",p.style.color="#487297";const g=document.createElement("input");g.type="number",g.value=(-44).toString(),d.append(h,c,p,g),d.style.marginBottom="2rem",[c,g].forEach(w=>{w.onchange=()=>{n.setGeopos(Number(c.value),Number(g.value))}}),_.append(i),_.appendChild(d),_.appendChild(r),u.forEach(w=>a.appendChild(w)),_.appendChild(a)}K().catch(_=>console.error(_));
